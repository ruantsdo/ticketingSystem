SCRIPTS

==== Privileges ====

ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'password';
flush privileges;

==== Sectors Table ====

CREATE TABLE `database`.`sectors` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(150) NOT NULL,
  `description` VARCHAR(500) NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE);

INSERT INTO sectors (name, description)
VALUES
('TI', 'Setor de Tecnologia da informação'),
('TRANSPORTE', 'Setor para gerenciar os transportes relacionados a empresa');

==== Services Table ====

CREATE TABLE `database`.`service` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(150) NOT NULL,
  `description` VARCHAR(500) NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `name_UNIQUE` (`name` ASC) VISIBLE);

INSERT INTO services (name, description)
VALUES
('Serviço 1', 'Serviço de testes'),
('Serviço 2', 'Outro serviço para testes');

==== Permission Levels Table ====

CREATE TABLE `database`.`permission_levels` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`name` VARCHAR(60) NOT NULL,
  PRIMARY KEY (`id`)
);

INSERT INTO permission_levels (name)
VALUES
("TELA"),
("FUNCIONÁRIO"),
("COORDENADOR"),
("ADMINISTRADOR"),
("MASTER");

==== Users Table ====

CREATE TABLE `database`.`users` (
	`id` INT NOT NULL AUTO_INCREMENT,
	`name` VARCHAR(150) NOT NULL,
	`email` VARCHAR(100) NULL,
	`cpf` VARCHAR(11) NOT NULL,
	`sector` VARCHAR(150) NOT NULL,
  `table` VARCHAR(50) NULL,
	`permission_level` INT NOT NULL,
	`password` VARCHAR(255) NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`, `cpf`),
  UNIQUE INDEX `cpf_UNIQUE` (`cpf` ASC) VISIBLE,
  FOREIGN KEY (`sector`) REFERENCES `database`.`sectors`(`name`),
  FOREIGN KEY (`permission_level`) REFERENCES `database`.`permission_levels`(`id`)
);

SET FOREIGN_KEY_CHECKS = 0;
SET unique_checks = 0;

INSERT INTO users (name, email, cpf, sector, permission_level, password) VALUES ('admin', '', '', '', 5, 'admin');

SET FOREIGN_KEY_CHECKS = 1;
SET unique_checks = 1;

INSERT INTO users (name, email, cpf, sector, permission_level, password)
VALUES ('Ruan Oliveira', 'ruantsdo@gmail.com', '05831605574', 'TI', '4', '$2b$10$Id3UhDjeo355Qk8GjxaGju0sYzCJ3ysrVCrIKkBG0wrEoCnten8Xi')


==== Tokens Table ====

CREATE TABLE `database`.`tokens` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `sector` VARCHAR(150) NOT NULL,
  `service` VARCHAR(150) NOT NULL,
  `priority` BOOLEAN NOT NULL,
  `requested_by` VARCHAR(150) NULL,
  `created_by` VARCHAR(150) NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `solved_by` VARCHAR(150) NULL,
  `solved_at` TIMESTAMP NULL,
  `table` VARCHAR(50) NULL,
  PRIMARY KEY (`id`)
);

==== Queue Table ====

CREATE TABLE `database`.`queue` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `token` INT NOT NULL,
  `requested_by` VARCHAR(60) NULL,
  `called_by` VARCHAR(150) NOT NULL,
  `called_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `sector` VARCHAR(150) NOT NULL,
  `table` VARCHAR(150) NOT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`token`) REFERENCES `database`.`tokens`(`id`)
);

====  Delayed queue ====

CREATE TABLE `database`.`delayedQueue` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `token` INT NOT NULL,
  `requested_by` VARCHAR(60) NULL,
  `called_by` VARCHAR(150) NOT NULL,
  `called_at` TIMESTAMP NOT NULL,
  `delayed_by` VARCHAR(150) NOT NULL,
  `delayed_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `sector` VARCHAR(150) NOT NULL,
  `table` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`token`) REFERENCES `database`.`tokens`(`id`)
);